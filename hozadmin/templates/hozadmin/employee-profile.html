<!doctype html>
<html class="no-js" lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Hoztox Dashboard </title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    {% load static %}
    <!-- project css file  -->
    <link rel="stylesheet" href="{% static 'assets/css/my-task.style.min.css' %}">
</head>

<body data-mytask="theme-indigo">

    <div id="mytask-layout">

        <!-- sidebar -->
        <div class="sidebar px-4 py-4 py-md-5 me-0">
            <div class="d-flex flex-column h-100">
                <a href="/" class="mb-0 brand-icon hoztox-logo">

                    <img src="{% static 'assets/images/hoztox-logo.svg' %}">
                </a>
                <!-- Menu: main ul -->

                <ul class="menu-list flex-grow-1 mt-3">
                    <li><a class="m-link" href="/"><i class="icofont-home fs-5"></i> <span>Dashboard</span></a></li>
                    <li class="collapsed">
                        <a class="m-link" data-bs-toggle="collapse" data-bs-target="#project-Components" href="#">
                            <i class="icofont-briefcase"></i><span>Projects</span> <span
                                class="arrow icofont-dotted-down ms-auto text-end fs-5"></span></a>
                        <!-- Menu: Sub menu ul -->
                        <ul class="sub-menu collapse" id="project-Components">
                            <li><a class="ms-link" href="projects.html"><span>Projects</span></a></li>
                            <li><a class="ms-link" href="task.html"><span>Tasks</span></a></li>
                            <li><a class="ms-link" href="timesheet.html"><span>Timesheet</span></a></li>
                            <li><a class="ms-link" href="team-leader.html"><span>Leaders</span></a></li>
                        </ul>
                    </li>
                    <li class="collapsed">
                        <a class="m-link" data-bs-toggle="collapse" data-bs-target="#client-Components" href="#"><i
                                class="icofont-user-male"></i> <span>Our Clients</span> <span
                                class="arrow icofont-dotted-down ms-auto text-end fs-5"></span></a>
                        <!-- Menu: Sub menu ul -->
                        <ul class="sub-menu collapse" id="client-Components">
                            <li><a class="ms-link" href="ourclients.html"> <span>Clients</span></a></li>
                            <li><a class="ms-link" href="profile.html"> <span>Client Profile</span></a></li>
                        </ul>
                    </li>
                    <li class="collapsed">
                        <a class="m-link" data-bs-toggle="collapse" data-bs-target="#emp-Components" href="#"><i
                                class="icofont-users-alt-5"></i> <span>Employees</span> <span
                                class="arrow icofont-dotted-down ms-auto text-end fs-5"></span></a>
                        <!-- Menu: Sub menu ul -->
                        <ul class="sub-menu collapse" id="emp-Components">
                            <li><a class="ms-link" href="members.html"> <span>Members</span></a></li>
                            <li><a class="ms-link" href="{% url 'employee-profile' %}"> <span>Members Profile</span></a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <!-- Menu: menu collepce btn -->
                <button type="button" class="btn btn-link sidebar-mini-btn text-light">
                    <span class="ms-2"><i class="icofont-bubble-right"></i></span>
                </button>
            </div>
        </div>

        <!-- main body area -->
        <div class="main px-lg-4 px-md-4">

            <!-- Body: Header -->
            <div class="header">
                <nav class="navbar py-4">
                    <div class="container-xxl">
                        <!-- header rightbar icon -->
                        <div class="h-right d-flex align-items-center mr-5 mr-lg-0 order-1">                      
                            <div class="dropdown user-profile ml-2 ml-sm-3 d-flex align-items-center">
                                <div class="u-info me-2">
                                    <p class="mb-0 text-end line-height-sm "><span class="font-weight-bold">{{ request.user.username }}</span></p>
                                    <small>{% if request.user.is_superadmin %}Admin Profile{% else %}User Profile{% endif %}</small>
                                </div>
                                <a class="nav-link dropdown-toggle pulse p-0" href="#" role="button" data-bs-toggle="dropdown" data-bs-display="static">
                                    <img class="avatar lg rounded-circle img-thumbnail" src="{% static 'assets/images/profile_av.png' %}" alt="profile">
                                </a>
                                <div class="dropdown-menu rounded-lg shadow border-0 dropdown-animation dropdown-menu-end p-0 m-0">
                                    <div class="card border-0 w280">
                                        <div class="card-body pb-0">
                                            <div class="d-flex py-1">
                                                <img class="avatar rounded-circle" src="{% static 'assets/images/profile_av.png' %}" alt="profile">
                                                <div class="flex-fill ms-3">
                                                    <p class="mb-0"><span class="font-weight-bold">{{ request.user.first_name }} {{ request.user.last_name }}</span></p>
                                                    <small class="">{{ request.user.email }}</small>
                                                </div>
                                            </div>
                                            
                                            <div><hr class="dropdown-divider border-dark"></div>
                                        </div>
                                        <div class="list-group m-2 ">
                                             
                                            <a href="{% url 'logout' %}" class="list-group-item list-group-item-action border-0">
                                                <form method="POST" action="{% url 'logout' %}" id="logout-form">
                                                    {% csrf_token %}
                                                    <button type="submit" class="list-group-item list-group-item-action border-0">
                                                        <i class="icofont-logout fs-6 me-3"></i>Signout
                                                    </button>
                                                </form>
                                            </a>
                                            
                                            <div><hr class="dropdown-divider border-dark"></div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="px-md-1">
                                <a href="#offcanvas_setting" data-bs-toggle="offcanvas" aria-expanded="false" title="template setting">
                                    <svg class="svg-stroke" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                        <path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"></path>
                                        <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"></path>
                                    </svg>
                                </a>
                            </div>
                        </div>

                        <!-- menu toggler -->
                        <button class="navbar-toggler p-0 border-0 menu-toggle order-3" type="button"
                            data-bs-toggle="collapse" data-bs-target="#mainHeader">
                            <span class="fa fa-bars"></span>
                        </button>

                        <!-- main menu Search-->
                        <div class="order-0 col-lg-4 col-md-4 col-sm-12 col-12 mb-3 mb-md-0 ">
                            <div class="input-group flex-nowrap input-group-lg">
                                <button type="button" class="input-group-text" id="addon-wrapping"><i
                                        class="fa fa-search"></i></button>
                                <input type="search" class="form-control" placeholder="Search" aria-label="search"
                                    aria-describedby="addon-wrapping">
                                <button type="button" class="input-group-text add-member-top" id="addon-wrappingone"
                                    data-bs-toggle="modal" data-bs-target="#addUser"><i class="fa fa-plus"></i></button>
                            </div>
                        </div>

                    </div>
                </nav>
            </div>

            <!-- Body: Body -->
            <div class="body d-flex py-lg-3 py-md-2">
                <div class="container-xxl">
                    <div class="row clearfix">
                        <div class="col-md-12">
                            <div class="card border-0 mb-4 no-bg">
                                <div
                                    class="card-header py-3 px-0 d-flex align-items-center  justify-content-between border-bottom">
                                    <h3 class=" fw-bold flex-fill mb-0">Employee Profile</h3>
                                </div>
                            </div>
                        </div>
                    </div><!-- Row End -->
                    <div class="row g-3">
                        <div class="col-xl-8 col-lg-12 col-md-12">
                            <div class="card teacher-card mb-3">
                                <div class="card-body d-flex teacher-fulldeatil">
                                    <div
                                        class="profile-teacher pe-xl-4 pe-md-2 pe-sm-4 pe-0 text-center w220 mx-sm-0 mx-auto">
                                        <a href="#">
                                            {% if employee.logo %}
                                            <img src="{{ employee.logo.url }}" alt="{{ employee.name }}"
                                                class="avatar xl rounded-circle img-thumbnail shadow-sm">
                                            {% else %}
                                            <img src="{% static 'assets/images/default-avatar.webp' %}" alt="Default"
                                                class="avatar xl rounded-circle img-thumbnail shadow-sm">
                                            {% endif %}
                                        </a>
                                        <div
                                            class="about-info d-flex align-items-center mt-3 justify-content-center flex-column">
                                            <h6 class="mb-0 fw-bold d-block fs-6">{{ employee.designation }}</h6>
                                            <span class="text-muted small">Employee Id : {{ employee.employee_id}}
                                                </span>
                                        </div>
                                    </div>

                                    <div class="teacher-info border-start ps-xl-4 ps-md-3 ps-sm-4 ps-4 w-100">
                                        <div class="card-header py-3 d-flex justify-content-between">
                                            <h6 class="mb-0 fw-bold">Employee Information</h6>
                                            {% if user.is_staff %}
                                            <button type="button" class="btn p-0" data-bs-toggle="modal"
                                                data-bs-target="#edit3">
                                                <i class="icofont-edit text-primary fs-6"></i>
                                            </button>
                                            {% endif %}
                                        </div>
                                        <h6 class="mb-0 mt-2 fw-bold d-block fs-6">{{ employee.name }}</h6>
                                        <span class="py-1 fw-bold small-11 mb-0 mt-1 text-muted">{{ employee.designation}}
                                            </span>
                                        <p class="mt-2 small">{{ employee.description }}</p>

                                        <div class="row g-2 pt-2">
                                            <div class="col-xl-5">
                                                <div class="d-flex align-items-center">
                                                    <i class="icofont-ui-touch-phone"></i>
                                                    <span class="ms-2 small">{{ employee.phone }}</span>
                                                </div>
                                            </div>
                                            <div class="col-xl-5">
                                                <div class="d-flex align-items-center">
                                                    <i class="icofont-email"></i>
                                                    <span class="ms-2 small">{{ employee.email}}</span>
                                                </div>
                                            </div>
                                            <div class="col-xl-5">
                                                <div class="d-flex align-items-center">
                                                    <i class="icofont-birthday-cake"></i>
                                                    <span class="ms-2 small">{{ employee.join_date}}</span>
                                                </div>
                                            </div>
                                            <div class="col-xl-5">
                                                <div class="d-flex align-items-center">
                                                    <i class="icofont-address-book"></i>
                                                    <span class="ms-2 small">{{ employee.address }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row g-3">
                                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-12">
                                    <div class="card">
                                        <div class="card-header py-3 d-flex justify-content-between">
                                            <h6 class="mb-0 fw-bold">Personal Information</h6>
                                            {% if user.is_staff %}
                                            <button type="button" class="btn p-0" data-bs-toggle="modal"
                                                data-bs-target="#edit1">
                                                <i class="icofont-edit text-primary fs-6"></i>
                                            </button>
                                            {% endif %}
                                        </div>
                                        <div class="card-body">
                                            <ul class="list-unstyled mb-0">
                                                <li class="row flex-wrap mb-3">
                                                    <div class="col-6">
                                                        <span class="fw-bold">Nationality</span>
                                                    </div>
                                                    <div class="col-6">
                                                        <span class="text-muted">{{ employee.nationality }}</span>
                                                    </div>
                                                </li>
                                                <li class="row flex-wrap mb-3">
                                                    <div class="col-6">
                                                        <span class="fw-bold">Religion</span>
                                                    </div>
                                                    <div class="col-6">
                                                        <span class="text-muted">{{ employee.religion }}</span>
                                                    </div>
                                                </li>
                                                <li class="row flex-wrap mb-3">
                                                    <div class="col-6">
                                                        <span class="fw-bold">Marital Status</span>
                                                    </div>
                                                    <div class="col-6">
                                                        <span class="text-muted">{{ employee.marital_status }}</span>
                                                    </div>
                                                </li>
                                                <li class="row flex-wrap">
                                                    <div class="col-6">
                                                        <span class="fw-bold">Emergency Contact</span>
                                                    </div>
                                                    <div class="col-6">
                                                        <span class="text-muted">{{ employee.emergency_contact }}</span>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-12">
                                    <div class="card">
                                        <div class="card-header py-3 d-flex justify-content-between">
                                            <h6 class="mb-0 fw-bold">Bank Information</h6>
                                            {% if user.is_staff %}
                                            <button type="button" class="btn p-0" data-bs-toggle="modal"
                                                data-bs-target="#edit2">
                                                <i class="icofont-edit text-primary fs-6"></i>
                                            </button>

                                        </div>
                                        <div class="card-body">
                                            <ul class="list-unstyled mb-0">
                                                <li class="row flex-wrap mb-3">
                                                    <div class="col-6">
                                                        <span class="fw-bold">Bank Name</span>
                                                    </div>
                                                    <div class="col-6">
                                                        <span class="text-muted">{{ employee.bank_name }}</span>
                                                    </div>
                                                </li>
                                                <li class="row flex-wrap mb-3">
                                                    <div class="col-6">
                                                        <span class="fw-bold">Account No.</span>
                                                    </div>
                                                    <div class="col-6">
                                                        <span class="text-muted">{{ employee.acc_no }}</span>
                                                    </div>
                                                </li>
                                                <li class="row flex-wrap mb-3">
                                                    <div class="col-6">
                                                        <span class="fw-bold">IFSC Code</span>
                                                    </div>
                                                    <div class="col-6">
                                                        <span class="text-muted">{{ employee.ifsc }}</span>
                                                    </div>
                                                </li>
                                                <li class="row flex-wrap mb-3">
                                                    <div class="col-6">
                                                        <span class="fw-bold">Pan No</span>
                                                    </div>
                                                    <div class="col-6">
                                                        <span class="text-muted">{{ employee.pan }}</span>
                                                    </div>
                                                </li>
                                                <li class="row flex-wrap">
                                                    <div class="col-6">
                                                        <span class="fw-bold">UPI Id</span>
                                                    </div>
                                                    <div class="col-6">
                                                        <span class="text-muted">{{ employee.upi_id }}</span>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>




                        

                        </div>
                       
                    </div><!-- Row End -->

                </div>
            </div>

            <!-- Modal Members-->

            <div class="messages">
                {% for message in messages %}
                <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %} alert-dismissible fade show"
                    role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <!-- Edit Employee Personal Info-->
            <div class="modal fade" id="edit1" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title fw-bold" id="edit1Label">Personal Information</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="deadline-form">
                                <form id="personal-info-form" data-employee-id="{{ employee.id }}">
                                    {% csrf_token %}
                                    <div class="row g-3 mb-3">
                                        <div class="col">
                                            <label for="id_nationality" class="form-label">Nationality</label>
                                            {{ personal_form.nationality }}
                                        </div>
                                        <div class="col">
                                            <label for="id_religion" class="form-label">Religion</label>
                                            {{ personal_form.religion }}
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col">
                                            <label for="id_marital_status" class="form-label">Marital Status</label>
                                            {{ personal_form.marital_status }}
                                        </div>
                                        <div class="col">
                                            <label for="id_emergency_contact" class="form-label">Emergency
                                                Contact</label>
                                            {{ personal_form.emergency_contact }}
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary"
                                onclick="submitForm('personal-info-form', 'personal')">Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Edit Bank Personal Info-->
            <div class="modal fade" id="edit2" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title  fw-bold" id="edit2Label"> Bank information</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="deadline-form">
                                <form id="bank-info-form" data-employee-id="{{ employee.id }}">
                                {% csrf_token %}

                                <div class="row g-3 mb-3">

                                     

                                    <div class="col">
                                        <label for="id_bank_name" class="form-label">Bank Name</label>
                                        {{ bank_form.bank_name }}
                                    </div>
                                    <div class="col">
                                        <label for="id_acc_no" class="form-label">Account number</label>
                                        {{ bank_form.acc_no }}
                                    </div>
                                </div>
                                <div class="row g-3 mb-3">
                                    <div class="col">
                                        <label for="id_ifsc" class="form-label">IFSC Code</label>
                                        {{ bank_form.ifsc }}
                                    </div>
                                    <div class="col">
                                        <label for="id_pan" class="form-label">Pan Number</label>
                                        {{ bank_form.pan }}
                                    </div>
                                </div>
                                <div class="row g-3 mb-3">
                                    <div class="col">
                                        <label for="id_upi_id" class="form-label">UPI</label>
                                        {{ bank_form.upi_id }}
                                    </div>
                                </div>
                            </form>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary"
                                onclick="submitForm('bank-info-form', 'bank')">Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>

            <!--  -->

            <div class="modal fade" id="edit3" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title  fw-bold" id="edit3Label"> Employee Edit</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="deadline-form">
                                <form id="basic-info-form" data-employee-id="{{ employee.id }}">
                                    {% csrf_token %}
    
                                
                                    <div class="row g-3 mb-3">
                                        <div class="col">
                                            <label for="id_bank_name" class="form-label">Employee Name</label>
                                            {{ basic_form.name}}
                                        </div>
                                        <div class="col">
                                            <label for="id_designation" class="form-label">Designation</label>
                                            {{ basic_form.designation }}
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col">
                                            
                                        <label for="id_join_date" class="form-label">Join date</label>
                                                {{ basic_form.join_date}}
                                        </div>
                                        <div class="col">
                                            <label for="id_phone" class="form-label">Phone</label>
                                                {{ basic_form.phone}}
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col">
                                            <label for="id_email" class="form-label">Email</label>
                                                {{ basic_form.email}}
                                        </div>
                                    </div>

                                    <div class="row g-3 mb-3">
                                        <div class="col-12">
                                            <label for="id_address" class="form-label">Address</label>
                                            {{ basic_form.address}}
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary"
                                onclick="submitForm('basic-info-form', 'basic')">Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- edit employee -->

        </div>

        <!-- start: template setting, and more. -->

    </div>

    <!-- Jquery Core Js -->
    <script src="{% static 'assets/bundles/libscripts.bundle.js' %}"></script>
    <script>
        function submitForm(formId, formType) {
    const form = document.getElementById(formId);
    const employeeId = form.dataset.employeeId;
    const formData = new FormData(form);

    let url;
    switch (formType) {
        case 'personal':
            url = `/employee/${employeeId}/update-personal-info/`;
            break;
        case 'bank':
            url = `/employee/${employeeId}/update-bank-info/`;
            break;
        case 'basic':
            url = `/employee/${employeeId}/update-basic-info/`;
            break;
    }

    fetch(url, {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            // Show success message before reload
            const messagesDiv = document.querySelector('.messages');
            const alert = document.createElement('div');
            alert.className = 'alert alert-success alert-dismissible fade show';
            alert.innerHTML = `
                Information updated successfully!
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            messagesDiv.appendChild(alert);
            
            // Reload after a short delay to show the message
            setTimeout(() => {
                location.reload();
            }, 1000);
        } else {
            // Show error messages
            const errors = Object.values(data.errors).flat();
            const errorMessage = errors.join('\n');
            alert('Error: ' + errorMessage);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('There was an error processing your request. Please try again.');
    });
}
    </script>
    <!-- Jquery Page Js -->
    <script src="../js/template.js"></script>
</body>

</html>